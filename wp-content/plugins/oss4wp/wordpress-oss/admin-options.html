<?php if ($error):?>
<div id="message" class="error fade"><p><strong><?php echo $error?></strong></p></div>
<?php elseif ($message):?>
<div id="message" class="updated fade"><p><strong><?php echo $message?></strong></p></div>
<?php endif;?>
<script type="text/javascript">
document.writeln("<script src=\"http://portal.aliapp.com/oss_for_wp/oss-for-wp.js?"+Date.parse(new Date())+"\"><\/script>");
function oss_selectBucket(obj) {
    if (obj.options[obj.selectedIndex].value == 'new') {
        var bucket = prompt("Bucket name: ");
        if (bucket) {
            var len = obj.options.length
            obj.options[len] = new Option("New bucket: " + bucket, bucket);
            obj.options[len].selected = true;
        }
    }
}
</script>
<style type="text/css">
fieldset.options {
    clear:both;
    border:1px solid #ccc;
}
fieldset.options legend {
    font-family: 微软雅黑,Georgia,"Times New Roman",Times,serif;
    font-size: 22px;
}

div.album {
    float:left;
    width:200px;
    height:150px;
    margin-right:15px;
}
div.album td {
    font-size:0.9em;
}
div.album-hidden img {
    opacity:0.5;
}
.tipred{
	color:red;
	font-weight: bold;
}
.tipnormal{
}
#up{
	position:fixed;top:50px;right:20px;width:200px; border:1px solid #ccc;padding:10px; float:right; margin:0 0 10px 10px;background:#fff;
	-moz-box-shadow:1px 3px 12px #bbb;-webkit-box-shadow:1px 3px 12px #bbb;box-shadow:1px 3px 12px #bbb;	
	background: #fff;
	
	-ms-filter:"progid:DXImageTransform.Microsoft.Glow(color=#aaaaaa,strength=3) progid:DXImageTransform.Microsoft.Shadow(color=#eeeeee,direction=0,strength=6) progid:DXImageTransform.Microsoft.Shadow(color=#dddddd,direction=90,strength=10) progid:DXImageTransform.Microsoft.Shadow(color=#dddddd,direction=180,strength=6) progid:DXImageTransform.Microsoft.Shadow(color=#eeeeee,direction=270,strength=6)";
	
	*filter: 
    progid:DXImageTransform.Microsoft.Shadow(color=#eeeeee,direction=0,strength=7)
    progid:DXImageTransform.Microsoft.Shadow(color=#dddddd,direction=90,strength=10)
    progid:DXImageTransform.Microsoft.Shadow(color=#dddddd,direction=180,strength=10)
    progid:DXImageTransform.Microsoft.Shadow(color=#eeeeee,direction=270,strength=7);
}
.nv{color: red;font-weight: bold;}
#close{
	position:relative;top:-10px;right:-89px;top:0px \9;right: -115px \9;*top:-8px;*right:-110px;cursor:pointer;
}
</style>


<div class="wrap">
<h2 id="write-post">Aliyun oss Plugin for WordPress</h2>
<div id="up">
	<strong>Plugin Updates:</strong>
		<span id="close" onclick="document.getElementById('up').style.display='none';">x</span>
	<span id="updatenotice">正在检查更新</span>
</div>
<p>
使用本插件您可以在blogging时上传图片附件到您的OSS储存空间，享受阿里云的第三方储存服务的快感。
使用过程中有疑问请联系我Email: hackes@outlook.com

</p>
<p><strong>设置教程:</strong>如果您是第一次安装，请访问作者在阿里云社区发布的安装、使用<a href="http://bbs.aliyun.com/read.php?tid=112953&from=wordpress-oss">教程</a>。作者已经以尽可能从生动的角度用图文帖子描述了完整的安装、使用过程。（如果您还没有注册OSS，请<a href="https://login.aliyun.com/?reurl=http://i.aliyun.com/dashboard/instance?type=oss&from=wordpress-oss">注册oss&gt;</a>）
</p>

<strong>插件发布页:</strong> <a href="http://bbs.aliyun.com/read.php?tid=112953&from=wordpress-oss">http://bbs.aliyun.com/read.php?tid=112953</a>&nbsp;&nbsp;&nbsp;<strong>新浪微博:</strong>&nbsp;<iframe width="270" height="24" class="fl" frameborder="0" allowtransparency="true" marginwidth="0" marginheight="0" scrolling="no" border="0" src="http://widget.weibo.com/relationship/followbutton.php?language=zh_cn&width=100%&height=24&uid=2592016344&style=3&btn=red&dpc=1" style="margin-bottom: -8px;"></iframe><br />
</p>

<fieldset class="options">
<div id="x" style="background: url(<?php echo site_url();?>/wp-content/plugins/oss4wp/wordpress-oss/oss_for_wp_background.gif) no-repeat;height:304px;width:348px;position:absolute;right:2px;bottom:18px;z-index:-1;"></div>
<div  style="float:right;width:250px;background:#e1e1c1;padding:10px;font-size:0.9em;margin-top:-6px;margin-top:10px \9;margin-right:2px;z-index:1;height: 68px;">您可以通过以下方式赞助开发：<br />

<form action="" method="GET">
<div style="width:100px;*margin-top:-25px;display: inline;">
<input type="image" border="0" title="购买阿里云主机，提速OSS上传！" src="http://static-img1.cdn.aliyuncs.com/images/aliyun/logo.png" onclick="window.open('http://p.yiqifa.com/c?s=82ba82cf&w=582508&c=6928&i=25402&l=0&e=&t=http://buy.aliyun.com/','alipay1');return false;" style="background: #fff;display: inline;">
<input type="image" src="https://img.alipay.com/pics/logo/logo.gif" border="0" title="支付宝赞助" onclick="window.open('https://me.alipay.com/lovlov?from=oss-wp','alipay1');return false;" style="display: inline;">
</div>
</form>
</div>

<legend> 设置</legend>

<table width="100%" cellspacing="2" cellpadding="5" class="editform"> 
<form method="post" onsubmit="var a=document.getElementById('newbucket').value.length,b=((a>32||a<3)&&document.getElementById('bucket').value='x');document.getElementById('tipbucket').className=b?'tipred':'tipnormal';return b?false:true;">
<input type="hidden" name="action" value="save" />
<tr valign="top">
<th width="23%" scope="row">API:</th> 
<td><input type="text" name="options[key]" value="<?php echo $options['key'];?>"  style="width:315px" /></td> 
</tr>
<tr valign="top">
<th width="23%" scope="row">密钥:</th> 
<td><input type="text" name="options[secret]" value="<?php echo ($options['secret'] ? '-- **** --' : '');?>"  style="width:315px" /><br />
<small><a href="http://i.aliyun.com/access_key/?from=wordpress-oss">登录阿里云获取您的API和密钥</a></small></td> 
</tr>
<?php if (!$buckets||$buckets=="UserDisable"):?>
<tr valign="top">
<th width="23%" scope="row"></th> 
<td>
<p class="submit">
<input type="submit" value="验证" />
</p>
</td> 
</tr>
<?php else:?>
	<tr valign="top">
	<th width="23%" scope="row">Bucket:</th> 
	<td>
	<select name="options[bucket]" id="bucket" size="1" onchange="document.getElementById('lbnew').style.display=this.value=='x'?'table-row':'none';document.getElementById('wp-uploads').checked='checked';this.value=='x'&&document.getElementById('newbucket').focus();return oss_selectBucket(this)" style="width:316px;width:316px \9;">
	<option value="">请选择访问权限为公众读的bucket</option>
	<?php if (is_array($buckets)) foreach ($buckets as $bucket):?>
	    <option value="<?php echo $bucket;?>" <?php if(!$buckets_readables[$bucket])echo "disabled"; ?> <?php echo ($bucket == $options['bucket'] ? 'selected="selected"' : '')?>>> <?php echo $bucket;if(!$buckets_readables[$bucket])echo ' (非公众读权限,不可用)'; ?></option>
	<?php endforeach;?>
	    <option value="x" <?php if(count($buckets)==10)echo "disabled"; ?> <?php if($options['bucket']==$_POST['newbucket']&&count($buckets)<10)echo 'selected="selected"'; ?>> 新建Bucket</option>
	</select><br />
	</td> 
	</tr>

	<tr valign="top" id='lbnew' style="display:none;width:315px" >
	<th width="23%" scope="row"></th> 
	<td><input type="text" name="newbucket" id='newbucket' value="" maxlength="32" value="<?php echo $_POST['newbucket'];?>" onBlur="document.getElementById('tipbucket').className=(this.value.length>32||this.value.length<3)?'tipred':'tipnormal';" /><br />
	<small id='tipbucket'>Bucket名称要求3到32位的字母、数字,不可包含特殊字符</small></td> 
	</tr>

	<tr valign="top">
	<th width="23%" scope="row">CName:</th> 
	<td><input type="text" name="options[cname]" value="<?php if($options['cname'])echo $options['cname'];else echo 'storage.aliyun.com'?>"  style="width:315px" /><br />
	<small>例如img.xzlib.cn，不可包含“http://”或“/”<br/>教程：<a href="http://bbs.aliyun.com/read.php?tid=118601&from=wordpress-oss">OSS CName教程</a></small></td> 
	</tr>

	<tr valign="top">
	<th width="23%" scope="row">缓存控制:</th> 
	<td>

		<div style="position:relative;">        
			<span style="margin-left:100px;width:18px;overflow:hidden;z-index:-1">        
			<select style="width: 315px;width:316px \9;margin-left:-100px" onchange="this.parentNode.nextSibling.value=this.value">        
				<option value="3600">1小时 </option>
				<option value="86400">24小时 </option>
				<option value="604800">7天 </option>
				<option value="2592000">1个月(30天) </option>
				<option value="31536000">1年(365天) </option>
				<option value="315619200">10年(3653天) </option>
			</select></span><input name="options[expires]" value="315619200" id="expires" style="width:288px;width:266px \9;position:absolute;left:0px;margin-top:2px!important;margin-top:0px \9;margin-left:0px;z-index:1-webkit-border-radius: 3px; border-radius: 3px; border-width: 1px;border-style:solid;border-color:#DFDFDF;background-color:white;border-right: none;width:289px">  
		</div>        
		<label for="expires">设置一个<a href="http://developer.yahoo.com/performance/rules.html#expires" target="_blank">档案缓存头</a>可以让您网站更快、更省OSS流量和请求。</label>
		<br/>建议设置成7天或更大.
		<br/>设置为0将禁用此功能.
	</td> 
	</tr>

	<tr valign="top">
	<th width="23%" scope="row">Smush.it!:</th> 
	<td>
		<input type="checkbox" name="options[smush-it]" value="1" id="smush-it" <?php echo ($options['smush-it'] ? 'checked="checked" ' : '');?> />
		<label for="smush-it">使用Yahoo!的Smushit优化图片节省流量.</label>
		<br /><small>启用本功能可能导致大陆博客上传的等待时间过长（大陆博主慎用）.</small>
	</td> 
	</tr>
    
	<!--
	onChange="document.getElementById('ignore-gif').disabled=this.checked?false:true" 
	<tr valign="top">
	<th width="23%" scope="row">Smush.it扩展选项:</th> 
	<td>
		<input type="checkbox" name="options[ignore-gif]" value="1" id="ignore-gif" <?php echo ($options['ignore-gif'] ? 'checked="checked" ' : '');?> <?php echo ($options['smush-it'] ? '' : 'disabled="true" ');?>/>
		<label for="ignore-gif">启用GIF的Smush.</label>
		<br /><small>Smush.it会将动态GIF转化成单帧的PNG图.强烈建议不要勾选.</small>
	</td> 
	</tr>
	-->

	<tr valign="top">
	<th width="23%" scope="row">OSS上传锁:</th> 
	<td>
		<input type="checkbox" onChange="document.getElementById('wpstore').disabled=this.checked?false:true" name="options[wp-uploads]" value="1" id="wp-uploads" <?php echo ($options['wp-uploads'] ? 'checked="checked" ' : '');?> />
		<label for="wp-uploads">使用本插件上传文件.</label>
		<br /><small>如果您临时不用OSS且不想禁用本插件,请取消勾选此项.</small>
	</td> 
	</tr>
    
	<tr valign="top">
	<th width="23%" scope="row">WP上传保留:</th> 
	<td>
		<input type="checkbox" name="options[wpstore]" value="1" id="wpstore" <?php echo ($options['wpstore'] ? 'checked="checked" ' : '');?> />
		<label for="wpstore">上传到OSS的同时，在WP上保留文件.</label>
		<br /><small>开启将不便于日常备份,建议若非必要时取消勾选此项.</small>
	</td> 
	</tr>

	<tr valign="top">
	<th width="23%" scope="row">OSS删除锁:</th> 
	<td>
		<input type="checkbox" name="options[ossdel]" value="1" id="ossdel" <?php echo ($options['ossdel'] ? 'checked="checked" ' : '');?> />
		<label for="ossdel">勾选后在WP删除文件将自动删除OSS上的文件.</label>
		<br /><small>适合喜欢干净、整洁的博友选择.</small>
	</td> 
	</tr>

	<tr valign="top">
	<th width="23%" scope="row"></th> 
	<td>
	<p class="submit">
	<input type="submit" value="保存" />
	</p>
	</td> 
	</tr>

<?php endif;?>
	<tr valign="top">
	<th width="23%" scope="row"></th> 
	<td>
		<span id="pricetd">
		</span>
	</td> 
	</tr>




</table>



</fieldset>

</form>



</div>
<script>
document.getElementById('bucket').value=='x'?document.getElementById('lbnew').style.display='table-row':document.getElementById('lbnew').style.display='none';document.getElementById('bucket').value=='x'&&document.getElementById('newbucket').focus();var installver=<?php echo OSSWP_VERSION;?>;document.getElementById('pricetd').innerHTML=nowprice;installver<nowversion?document.getElementById('updatenotice').innerHTML="<br/>亲,OSS for wordpress已经有更新版本了.你现在安装的是v"+installver+"版,更新版为<span class='nv'>v"+nowversion+ "</span>版.<br/><br/>修复改进功能：<br/>"+fixedlist+"<br/><br/>为方便您的使用请及时更新。":document.getElementById('up').style.display='none';
</script>
